"use client";
"use strict";var A=Object.defineProperty,_=Object.defineProperties,M=Object.getOwnPropertyDescriptor,O=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertyNames,X=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var F=(t,e,r)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,S=(t,e)=>{for(var r in e||(e={}))U.call(e,r)&&F(t,r,e[r]);if(X)for(var r of X(e))H.call(e,r)&&F(t,r,e[r]);return t},b=(t,e)=>_(t,O(e));var Q=(t,e)=>{for(var r in e)A(t,r,{get:e[r],enumerable:!0})},Y=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of q(e))!U.call(t,n)&&n!==r&&A(t,n,{get:()=>e[n],enumerable:!(i=M(e,n))||i.enumerable});return t};var Z=t=>Y(A({},"__esModule",{value:!0}),t);var j={};Q(j,{BuilderEntities:()=>G,BuilderEntity:()=>w,BuilderEntityAttributes:()=>L,Interpreter:()=>g,InterpreterEntities:()=>J,InterpreterEntity:()=>v,createAttributeComponent:()=>K,createEntityComponent:()=>k,useBuilderStore:()=>$,useBuilderStoreData:()=>T,useInterpreterEntitiesValues:()=>W,useInterpreterStore:()=>N,useInterpreterStoreData:()=>D});module.exports=Z(j);var p=require("react"),l=require("@coltorapps/builder");var I=require("react/jsx-runtime");function $(t,e={}){let r=(0,p.useMemo)(()=>(0,l.createBuilderStore)(t,{initialData:e.initialData}),[t]);return(0,p.useEffect)(()=>r.subscribe((i,n)=>{n.forEach(d=>{var y;let o=(y=e.events)==null?void 0:y[`on${d.name}`];o==null||o(d.payload)})}),[r,e.events]),r}function T(t,e=()=>!0){let r=(0,p.useRef)(t.getData());return(0,p.useSyncExternalStore)(i=>t.subscribe((n,d)=>{e(d)&&(r.current=n,i())}),()=>r.current,()=>r.current)}function w(t){var y,B;let r=T(t.builderStore,s=>s.some(h=>h.name===l.builderStoreEventsNames.EntityUpdated&&h.payload.entity.id===t.entityId||h.name===l.builderStoreEventsNames.DataSet)).schema.entities[t.entityId];if(!r)throw new Error(`[Entity] The entity with ID "${t.entityId}" was not found.`);let i=(y=r==null?void 0:r.children)!=null?y:[],n=t.components[r.type];if(!n)throw new Error(`[Entity] No entity component found for the entity of type "${r.type}".`);let d=b(S({},r),{id:t.entityId});return((B=t.children)!=null?B:s=>s.children)({entity:d,children:(0,I.jsx)(n,{entity:d,setValue:()=>{},resetError:()=>{},resetValue:()=>{},clearValue:()=>{},validateValue:()=>new Promise(s=>s()),children:i.map(s=>(0,I.jsx)(w,{entityId:s,components:t.components,builderStore:t.builderStore},s))})})}function G(t){return T(t.builderStore,r=>r.some(i=>i.name===l.builderStoreEventsNames.RootUpdated||i.name===l.builderStoreEventsNames.DataSet)).schema.root.map(r=>{var i;return(0,I.jsx)(w,{entityId:r,components:t.components,builderStore:t.builderStore,children:(i=t.children)!=null?i:n=>n.children},r)})}var P=(0,p.createContext)({builderStore:(0,l.createBuilderStore)((0,l.createBuilder)({entities:[]})),entityId:""});function L(t){let r=T(t.builderStore,i=>i.some(n=>n.name===l.builderStoreEventsNames.EntityAdded||n.name===l.builderStoreEventsNames.EntityCloned||n.name===l.builderStoreEventsNames.EntityDeleted||n.name===l.builderStoreEventsNames.DataSet)).schema.entities[t.entityId];if(!r)throw new Error(`[Attributes] The entity with ID "${t.entityId}" was not found.`);return(0,I.jsx)(P.Provider,{value:{builderStore:t.builderStore,entityId:t.entityId},children:t.components[r.type]({})})}var c=require("react"),E=require("@coltorapps/builder");var V=require("react/jsx-runtime");function N(t,e,r={}){let i=(0,c.useMemo)(()=>(0,E.createInterpreterStore)(t,e,r),[t,e]);return(0,c.useEffect)(()=>i.subscribe((n,d)=>{d.forEach(o=>{var B;let y=(B=r.events)==null?void 0:B[`on${o.name}`];y==null||y(o.payload)})}),[i,r.events]),i}function D(t,e=()=>!0){let r=(0,c.useRef)(t.getData());return(0,c.useSyncExternalStore)(i=>t.subscribe((n,d)=>{e(d)&&(r.current=n,i())}),()=>r.current,()=>r.current)}function v(t){var x,C;let e=t.interpreterStore.schema.entities[t.entityId];if(!e)throw new Error(`[Entity] The entity with ID "${t.entityId}" was not found.`);let r=D(t.interpreterStore,u=>u.some(a=>a.name===E.interpreterStoreEventsNames.EntityValueUpdated&&a.payload.entityId===t.entityId||a.name===E.interpreterStoreEventsNames.EntityErrorUpdated&&a.payload.entityId===t.entityId||a.name===E.interpreterStoreEventsNames.DataSet)),i=t.interpreterStore.builder.entities.find(u=>u.name===e.type),n=b(S({},e),{id:t.entityId});if(!i)throw new Error(`[Entity] The definition for the entity of type "${e.type}" was not found.`);let d=t.components[e.type];if(!d)throw new Error(`[Entity] No entity component found for the entity of type "${e.type}".`);let o=(0,c.useRef)(t.interpreterStore.isEntityProcessable(t.entityId));if(!(0,c.useSyncExternalStore)(u=>t.interpreterStore.subscribe((a,m)=>{m.some(R=>(R.name===E.interpreterStoreEventsNames.EntityProcessable||R.name===E.interpreterStoreEventsNames.EntityUnprocessable)&&R.payload.entityId===t.entityId)&&(o.current=t.interpreterStore.isEntityProcessable(t.entityId),u())}),()=>o.current,()=>o.current))return null;let B=(x=e==null?void 0:e.children)!=null?x:[],s=b(S({},n),{value:r.entitiesValues[t.entityId],error:r.entitiesErrors[t.entityId]});return((C=t.children)!=null?C:u=>u.children)({entity:s,children:(0,V.jsx)(d,{entity:s,setValue:u=>t.interpreterStore.setEntityValue(t.entityId,u),validateValue:()=>t.interpreterStore.validateEntityValue(t.entityId),resetError:()=>t.interpreterStore.resetEntityError(t.entityId),resetValue:()=>t.interpreterStore.resetEntityValue(t.entityId),clearValue:()=>t.interpreterStore.clearEntityValue(t.entityId),children:B.map(u=>(0,V.jsx)(v,{entityId:u,components:t.components,interpreterStore:t.interpreterStore},u))})})}function J(t){return t.interpreterStore.schema.root.map(e=>{var r;return(0,V.jsx)(v,{entityId:e,components:t.components,interpreterStore:t.interpreterStore,children:(r=t.children)!=null?r:i=>i.children},e)})}var g=J;function W(t,e){let{entitiesValues:r}=D(t,i=>i.some(n=>n.name===E.interpreterStoreEventsNames.DataSet||n.name===E.interpreterStoreEventsNames.EntityValueUpdated&&e&&e.includes(n.payload.entityId)||n.name===E.interpreterStoreEventsNames.EntityValueUpdated&&!e));return e?e.reduce((i,n)=>(i[n]=r[n],i),{}):r}function k(t,e){return e}var z=require("react"),f=require("@coltorapps/builder");function K(t,e){function r(){var u;let{builderStore:i,entityId:n}=(0,z.useContext)(P),d=T(i,a=>a.some(m=>m.name===f.builderStoreEventsNames.EntityAttributeUpdated&&m.payload.entity.id===n&&m.payload.attributeName===t.name||m.name===f.builderStoreEventsNames.EntityAttributeErrorUpdated&&m.payload.entity.id===n&&m.payload.attributeName===t.name||m.name===f.builderStoreEventsNames.EntityAdded||m.name===f.builderStoreEventsNames.EntityCloned||m.name===f.builderStoreEventsNames.EntityDeleted||m.name===f.builderStoreEventsNames.DataSet)),o=d.schema.entities[n];if(!o)throw new Error(`[Attribute] The entity with ID "${n}" was not found.`);let y=i.builder.entities.find(a=>a.name===o.type);if(!y)throw new Error(`[Attribute] The definition for the entity of type "${o.type}" was not found.`);if(!y.attributes.find(a=>a.name===t.name))throw new Error(`[Attribute] The attribute "${t.name}" does not exist within the entity of type "${o.type}".`);let s=o.attributes[t.name],h=(u=d.entitiesAttributesErrors[n])==null?void 0:u[t.name],x={name:t.name,value:s,error:h},C=b(S({},o),{id:n});return e({attribute:x,entity:C,setValue:a=>i.setEntityAttribute(n,t.name,a),validateValue:()=>i.validateEntityAttribute(n,t.name),resetError:()=>i.resetEntityAttributeError(n,t.name)})}return r.displayName=e.name,r}0&&(module.exports={BuilderEntities,BuilderEntity,BuilderEntityAttributes,Interpreter,InterpreterEntities,InterpreterEntity,createAttributeComponent,createEntityComponent,useBuilderStore,useBuilderStoreData,useInterpreterEntitiesValues,useInterpreterStore,useInterpreterStoreData});
