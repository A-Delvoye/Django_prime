"use client";
var U=Object.defineProperty,$=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var R=(t,r,e)=>r in t?U(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,c=(t,r)=>{for(var e in r||(r={}))L.call(r,e)&&R(t,e,r[e]);if(v)for(var e of v(r))N.call(r,e)&&R(t,e,r[e]);return t},B=(t,r)=>$(t,G(r));import{createContext as g,useEffect as W,useMemo as k,useRef as z,useSyncExternalStore as K}from"react";import{builderStoreEventsNames as E,createBuilder as _,createBuilderStore as P}from"@coltorapps/builder";import{jsx as I}from"react/jsx-runtime";function M(t,r={}){let e=k(()=>P(t,{initialData:r.initialData}),[t]);return W(()=>e.subscribe((i,n)=>{n.forEach(d=>{var l;let o=(l=r.events)==null?void 0:l[`on${d.name}`];o==null||o(d.payload)})}),[e,r.events]),e}function b(t,r=()=>!0){let e=z(t.getData());return K(i=>t.subscribe((n,d)=>{r(d)&&(e.current=n,i())}),()=>e.current,()=>e.current)}function C(t){var l,m;let e=b(t.builderStore,y=>y.some(S=>S.name===E.EntityUpdated&&S.payload.entity.id===t.entityId||S.name===E.DataSet)).schema.entities[t.entityId];if(!e)throw new Error(`[Entity] The entity with ID "${t.entityId}" was not found.`);let i=(l=e==null?void 0:e.children)!=null?l:[],n=t.components[e.type];if(!n)throw new Error(`[Entity] No entity component found for the entity of type "${e.type}".`);let d=B(c({},e),{id:t.entityId});return((m=t.children)!=null?m:y=>y.children)({entity:d,children:I(n,{entity:d,setValue:()=>{},resetError:()=>{},resetValue:()=>{},clearValue:()=>{},validateValue:()=>new Promise(y=>y()),children:i.map(y=>I(C,{entityId:y,components:t.components,builderStore:t.builderStore},y))})})}function O(t){return b(t.builderStore,e=>e.some(i=>i.name===E.RootUpdated||i.name===E.DataSet)).schema.root.map(e=>{var i;return I(C,{entityId:e,components:t.components,builderStore:t.builderStore,children:(i=t.children)!=null?i:n=>n.children},e)})}var A=g({builderStore:P(_({entities:[]})),entityId:""});function q(t){let e=b(t.builderStore,i=>i.some(n=>n.name===E.EntityAdded||n.name===E.EntityCloned||n.name===E.EntityDeleted||n.name===E.DataSet)).schema.entities[t.entityId];if(!e)throw new Error(`[Attributes] The entity with ID "${t.entityId}" was not found.`);return I(A.Provider,{value:{builderStore:t.builderStore,entityId:t.entityId},children:t.components[e.type]({})})}import{useEffect as H,useMemo as Q,useRef as J,useSyncExternalStore as X}from"react";import{createInterpreterStore as Y,interpreterStoreEventsNames as p}from"@coltorapps/builder";import{jsx as w}from"react/jsx-runtime";function Z(t,r,e={}){let i=Q(()=>Y(t,r,e),[t,r]);return H(()=>i.subscribe((n,d)=>{d.forEach(o=>{var m;let l=(m=e.events)==null?void 0:m[`on${o.name}`];l==null||l(o.payload)})}),[i,e.events]),i}function V(t,r=()=>!0){let e=J(t.getData());return X(i=>t.subscribe((n,d)=>{r(d)&&(e.current=n,i())}),()=>e.current,()=>e.current)}function D(t){var f,h;let r=t.interpreterStore.schema.entities[t.entityId];if(!r)throw new Error(`[Entity] The entity with ID "${t.entityId}" was not found.`);let e=V(t.interpreterStore,u=>u.some(a=>a.name===p.EntityValueUpdated&&a.payload.entityId===t.entityId||a.name===p.EntityErrorUpdated&&a.payload.entityId===t.entityId||a.name===p.DataSet)),i=t.interpreterStore.builder.entities.find(u=>u.name===r.type),n=B(c({},r),{id:t.entityId});if(!i)throw new Error(`[Entity] The definition for the entity of type "${r.type}" was not found.`);let d=t.components[r.type];if(!d)throw new Error(`[Entity] No entity component found for the entity of type "${r.type}".`);let o=J(t.interpreterStore.isEntityProcessable(t.entityId));if(!X(u=>t.interpreterStore.subscribe((a,s)=>{s.some(x=>(x.name===p.EntityProcessable||x.name===p.EntityUnprocessable)&&x.payload.entityId===t.entityId)&&(o.current=t.interpreterStore.isEntityProcessable(t.entityId),u())}),()=>o.current,()=>o.current))return null;let m=(f=r==null?void 0:r.children)!=null?f:[],y=B(c({},n),{value:e.entitiesValues[t.entityId],error:e.entitiesErrors[t.entityId]});return((h=t.children)!=null?h:u=>u.children)({entity:y,children:w(d,{entity:y,setValue:u=>t.interpreterStore.setEntityValue(t.entityId,u),validateValue:()=>t.interpreterStore.validateEntityValue(t.entityId),resetError:()=>t.interpreterStore.resetEntityError(t.entityId),resetValue:()=>t.interpreterStore.resetEntityValue(t.entityId),clearValue:()=>t.interpreterStore.clearEntityValue(t.entityId),children:m.map(u=>w(D,{entityId:u,components:t.components,interpreterStore:t.interpreterStore},u))})})}function F(t){return t.interpreterStore.schema.root.map(r=>{var e;return w(D,{entityId:r,components:t.components,interpreterStore:t.interpreterStore,children:(e=t.children)!=null?e:i=>i.children},r)})}var j=F;function tt(t,r){let{entitiesValues:e}=V(t,i=>i.some(n=>n.name===p.DataSet||n.name===p.EntityValueUpdated&&r&&r.includes(n.payload.entityId)||n.name===p.EntityValueUpdated&&!r));return r?r.reduce((i,n)=>(i[n]=e[n],i),{}):e}function et(t,r){return r}import{useContext as rt}from"react";import{builderStoreEventsNames as T}from"@coltorapps/builder";function nt(t,r){function e(){var u;let{builderStore:i,entityId:n}=rt(A),d=b(i,a=>a.some(s=>s.name===T.EntityAttributeUpdated&&s.payload.entity.id===n&&s.payload.attributeName===t.name||s.name===T.EntityAttributeErrorUpdated&&s.payload.entity.id===n&&s.payload.attributeName===t.name||s.name===T.EntityAdded||s.name===T.EntityCloned||s.name===T.EntityDeleted||s.name===T.DataSet)),o=d.schema.entities[n];if(!o)throw new Error(`[Attribute] The entity with ID "${n}" was not found.`);let l=i.builder.entities.find(a=>a.name===o.type);if(!l)throw new Error(`[Attribute] The definition for the entity of type "${o.type}" was not found.`);if(!l.attributes.find(a=>a.name===t.name))throw new Error(`[Attribute] The attribute "${t.name}" does not exist within the entity of type "${o.type}".`);let y=o.attributes[t.name],S=(u=d.entitiesAttributesErrors[n])==null?void 0:u[t.name],f={name:t.name,value:y,error:S},h=B(c({},o),{id:n});return r({attribute:f,entity:h,setValue:a=>i.setEntityAttribute(n,t.name,a),validateValue:()=>i.validateEntityAttribute(n,t.name),resetError:()=>i.resetEntityAttributeError(n,t.name)})}return e.displayName=r.name,e}export{O as BuilderEntities,C as BuilderEntity,q as BuilderEntityAttributes,j as Interpreter,F as InterpreterEntities,D as InterpreterEntity,nt as createAttributeComponent,et as createEntityComponent,M as useBuilderStore,b as useBuilderStoreData,tt as useInterpreterEntitiesValues,Z as useInterpreterStore,V as useInterpreterStoreData};
